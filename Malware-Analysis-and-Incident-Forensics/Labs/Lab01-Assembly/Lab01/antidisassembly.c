/* Instructions
 *
 * Open CygWin and move to the folder containing the code:
 * cd /cygdrive/c/Users/student/Desktop/lab01
 * 
 * Then compile using MinGW (32-bit):
 * mingw32-gcc.exe antidisassembly.c -masm=intel -o antidisassembly.exe
 * 
 * We use an additional flag to indicate Intel syntax for
 * inline assembly (MinGW uses AT&T by default as in gcc)
 */

#include <stdio.h>

void sc() {
    __asm__(
    	".intel_syntax noprefix\n"
		"call $+5\n"
        "pop eax\n"
        "add eax, 10\n" // see size of surrounding instructions
        "jmp eax\n"
        ".long 0x14872342\n"
        ".long 0x0014BA53\n"
        ".long 0x00BB0000\n"
        ".long 0xB9000000\n"
        ".long 0x00000001\n"
        ".long 0xC18902EB\n"
        ".long 0x8919048D\n"
        ".long 0x01EA83CB\n"
        ".long 0x905BF475\n"
        "xchg edx, edx\n"
	);
}

typedef int(*fptr_t)();

int main(int argc, char* argv[]) {
    fptr_t f = (fptr_t)sc;
	int a = f();
	printf("Welcome to lecture number %d!\n", a);
	return 0;
}